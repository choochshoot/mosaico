<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Galer칤a Panal Ne칩n con M칰sica</title>
<style>
  :root {
    --hex-size: 140px;
    --gap: 2px;
    --hex-height: calc(var(--hex-size) * 1.1547);
    --vertical-overlap: calc(var(--hex-height) * 0.25);
    --neon-color: rgba(255, 0, 255, 0.9); /* Magenta */
  }
  body {
    margin: 0;
    background: #0b0b0b;
    font-family: sans-serif;
    color: white;
    overflow-x: hidden;
  }
  h1 {
    text-align: center;
    font-size: 3rem;
    margin-top: 20px;
    color: var(--neon-color);
    text-shadow:
      0 0 10px var(--neon-color),
      0 0 20px var(--neon-color),
      0 0 40px var(--neon-color);
    animation: neonPulse 2s infinite alternate;
  }
  @keyframes neonPulse {
    from { text-shadow: 0 0 10px var(--neon-color), 0 0 20px var(--neon-color); }
    to { text-shadow: 0 0 20px var(--neon-color), 0 0 40px var(--neon-color), 0 0 60px var(--neon-color); }
  }
  .wrap {
    padding: 16px;
    max-width: 1600px;
    margin: auto;
  }
  .honeycomb {
    display: flex;
    flex-wrap: wrap;
    gap: var(--gap);
    margin-top: calc(var(--vertical-overlap) * -1);
    justify-content: center;
  }
  .hex {
    position: relative;
    width: var(--hex-size);
    height: var(--hex-height);
    margin-top: calc(var(--vertical-overlap) * -1);
    flex: 0 0 auto;
    transition: transform 0.1s ease-out;
  }
  .hex-inner {
    position: absolute;
    inset: 0;
    clip-path: polygon(
      50% 0%,
      93% 25%,
      93% 75%,
      50% 100%,
      7% 75%,
      7% 25%
    );
    overflow: hidden;
    background: #111;
    box-shadow: 0 0 8px var(--neon-color),
                0 0 15px var(--neon-color),
                0 0 25px var(--neon-color);
    filter: drop-shadow(0 0 8px var(--neon-color))
            drop-shadow(0 0 15px var(--neon-color));
    animation: glowPulse 2s infinite ease-in-out;
  }
  @keyframes glowPulse {
    0%, 100% {
      box-shadow: 0 0 8px var(--neon-color),
                  0 0 15px var(--neon-color),
                  0 0 25px var(--neon-color);
    }
    50% {
      box-shadow: 0 0 15px var(--neon-color),
                  0 0 30px var(--neon-color),
                  0 0 45px var(--neon-color);
    }
  }
  .hex img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform .3s ease;
  }
  .row-first-offset {
    margin-left: calc(var(--hex-size) / 2 + var(--gap) / 2);
  }
</style>
</head>
<body>

<h1>Galer칤a Panal Ne칩n</h1>
<div class="wrap">
  <div class="honeycomb" id="honeycomb"></div>
</div>

<!-- YouTube IFrame API -->
<div style="display:none;">
  <div id="player"></div>
</div>

<script src="https://unpkg.com/@supabase/supabase-js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/heic2any/0.0.3/heic2any.min.js"></script>
<script>
  // 游댳 Pega aqu칤 tu URL y ANON KEY de Supabase
  const SUPABASE_URL = "https://cskqlyauszpgjvwgenth.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNza3FseWF1c3pwZ2p2d2dlbnRoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2MTY4ODMsImV4cCI6MjA3MDE5Mjg4M30.HAZEfpAH2AZzoDBmsUOe3O33oAFbcRIJksZLOyeRvPk";

  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  async function loadImages() {
    const { data, error } = await supabase
      .storage
      .from("imagenes-usuarios")
      .list("", { limit: 100 });

    if (error) {
      console.error("Error cargando im치genes:", error);
      return;
    }

    const container = document.getElementById("honeycomb");
    for (const file of data) {
      let url = `${SUPABASE_URL}/storage/v1/object/public/imagenes-usuarios/${file.name}`;
      if (file.name.toLowerCase().endsWith(".heic")) {
        url = await convertHeic(url);
      }
      const hex = document.createElement("div");
      hex.className = "hex";
      hex.innerHTML = `
        <div class="hex-inner">
          <img src="${url}" loading="lazy">
        </div>
      `;
      container.appendChild(hex);
    }
  }

  async function convertHeic(heicUrl) {
    const response = await fetch(heicUrl);
    const blob = await response.blob();
    const converted = await heic2any({ blob, toType: "image/jpeg", quality: 0.9 });
    return URL.createObjectURL(converted);
  }

  // 游댳 Mueve los hex치gonos con la m칰sica
  let audioContext, analyser, dataArray;
  function connectAudioToVisualizer() {
    const iframe = document.querySelector("iframe");
    const source = audioContext.createMediaElementSource(iframe);
    analyser = audioContext.createAnalyser();
    source.connect(analyser);
    analyser.connect(audioContext.destination);
    analyser.fftSize = 256;
    dataArray = new Uint8Array(analyser.frequencyBinCount);
    animateHex();
  }

  function animateHex() {
    requestAnimationFrame(animateHex);
    analyser.getByteFrequencyData(dataArray);
    let avg = dataArray.reduce((a, b) => a + b, 0) / dataArray.length;
    let scale = 1 + avg / 300;
    document.querySelectorAll(".hex").forEach((hex, i) => {
      hex.style.transform = `scale(${scale}) rotate(${Math.sin(i + avg / 50) * 3}deg)`;
    });
  }

  // 游댳 YouTube API
  let player;
  function onYouTubeIframeAPIReady() {
    player = new YT.Player("player", {
      height: "0",
      width: "0",
      videoId: "https://youtu.be/tN1_fubLMKs?si=6e_RKH6VA6T9TFEd", // Pega aqu칤 el ID de la canci칩n
      events: {
        onReady: (event) => {
          event.target.playVideo();
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
          connectAudioToVisualizer();
        }
      }
    });
  }

  loadImages();

  // Cargar YouTube API
  const tag = document.createElement("script");
  tag.src = "https://www.youtube.com/iframe_api";
  document.body.appendChild(tag);
</script>
</body>
</html>





